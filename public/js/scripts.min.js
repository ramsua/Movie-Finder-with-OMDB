"use strict";const profile=document.getElementById("profile"),appendForms=document.getElementById("append-forms"),moviesSection=document.getElementById("movies"),favorites=document.getElementById("favorites"),closeFavs=document.getElementById("close-favorites"),favsMovies=document.getElementById("favorites__movies"),alerts=document.getElementById("alerts"),time=1900,fragment=document.createDocumentFragment(),insertIfExistsUser=()=>{insertTemplateInto("logged-in-template","profile",!0),insertTemplateInto("search-form-template","append-forms",!0),replaceClass("append-forms","append-forms--profile","append-forms--search")},replaceClass=(e,t,a)=>{const r=document.getElementById(e);r&&r.classList.contains(t)?r.classList.replace(t,a):console.error(`La función "replaceClass()" dice: El elemento "${r}" no existe o no tiene la clase "${t}".`)},createElemForAlert=(e,t,a,r)=>{const s=document.createElement(e.toUpperCase()),n=document.getElementById(r);a.forEach(e=>{s.classList.add(e)}),s.textContent=t,n.appendChild(s),setTimeout(()=>{n.textContent=""},1900)},insertTemplateInto=(e,t,a=!1)=>{const r=document.getElementById(e),s=document.getElementById(t);if(r&&s){const e=document.importNode(r.content,!0);a&&(s.textContent=""),s.appendChild(e)}else console.error(`La función insertTemplate() dice: El elemento ${e} o ${t} no existen.`)},removeComponentsFrom=e=>{const t=document.getElementById(e);t&&(t.textContent="")},alertEmptyField=(e,t,a)=>{e?(e.classList.add(t),setTimeout(()=>{e.classList.remove(t)},a)):console.error(`La función "alertEmptyField()" dice: El elemento "${e}" no existe.`)},changePlaceholderValue=(e,t,a,r)=>{e?(e.placeholder=t,setTimeout(()=>{e.placeholder=a},r)):console.error(`La función "changePlaceholderValue()" dice: El elemento "${e}" no existe.`)},loSt=localStorage,ifUserExists=e=>{if(null!==loSt.getItem("movie-finder-users")){const t=JSON.parse(loSt.getItem("movie-finder-users"));let a=0;return t.forEach(t=>{t.id===e&&(a=1)}),1===a}return!1},setNewUser=e=>{if(null===loSt.getItem("movie-finder-users")){const t=[];t.push(e),setCurrentUser(e.id),loSt.setItem("movie-finder-users",JSON.stringify(t))}else{const t=JSON.parse(loSt.getItem("movie-finder-users"));ifUserExists(e.id)?createElemForAlert("p",`El usuario ${e.id} ya existe.`,["alerts__alert","alert"],"alerts"):(t.push(e),setCurrentUser(e.id)),loSt.setItem("movie-finder-users",JSON.stringify(t))}},getUserLogin=e=>{ifUserExists(e)?setCurrentUser(e):createElemForAlert("p",`El usuario ${e} no existe.`,["alerts__alert","alert"],"alerts")},seSt=sessionStorage,setCurrentUser=e=>{seSt.setItem("currentUser",JSON.stringify(e)),insertTemplateInto("logged-in-template","profile",!0),insertTemplateInto("search-form-template","append-forms",!0),replaceClass("append-forms","append-forms--profile","append-forms--search")},getCurrentUser=()=>JSON.parse(seSt.getItem("currentUser")),currentUserLoggedIn=()=>null!==seSt.getItem("currentUser"),singOff=()=>{seSt.removeItem("currentUser"),favorites.classList.contains("favorites__active")&&favorites.classList.remove("favorites__active")},apikey="8651a58e",searchMovies=e=>{axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?(removeComponentsFrom("movies"),insertMovies(e.data.Search)):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},searchTitle=e=>{axios({method:"GET",url:`https://www.omdbapi.com/?apikey=8651a58e&i=${e}&plot=full`}).then(e=>{insertInfo(e.data)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},insertMovie=e=>{const t=document.createElement("ARTICLE");t.classList.add("movie"),t.innerHTML=`<button class="button movie__favorite" data-favoriteid="${e.imdbID}">\n            <img src="./assets/favorites/bookmark.svg" class="movie__favorite--svg" data-addfavorite="add-favorite">\n        </button>\n        <picture class="movie__poster">\n            <img src="${e.Poster}" class="poster">\n        </picture>\n        <div class="movie__info">\n            <h2 class="movie__title">${e.Title}</h2>\n            <button class="movie__button button button--cta" data-id="show-info" data-imdbid="${e.imdbID}">Información</button>\n        </div>`,fragment.appendChild(t)},insertMovies=e=>{e.forEach(e=>{insertMovie(e)}),moviesSection.appendChild(fragment)},insertInfo=e=>{const t=document.createElement("ARTICLE");t.classList.add("movie-info"),t.innerHTML=`<div class="remove-component">\n            <button data-removecomponent="remove-component"\n                class="remove-component__trigger button button--secondary">X</button>\n        </div>\n            <picture class="movies-info__poster">\n                <img src="${e.Poster}">\n            </picture>\n            <section class="movies-info__details">\n                <h1 class="movies-info__title">${e.Title}</h1>\n                <p>Actors: <span class="dark-color-lighten">${e.Actors}</span></p>\n                <p>Writes: <span class="dark-color-lighten">${e.Writer}</span></p>\n                <p>Production: <span class="dark-color-lighten">${e.Production}</span></p>\n                <p>Director: <span class="dark-color-lighten">${e.Director}</span></p>\n                <p>Genre: <span class="dark-color-lighten">${e.Genre}</span></p>\n                <p>Language: <span class="dark-color-lighten">${e.Language}</span></p>\n                <p>Plot: <span class="dark-color-lighten">${e.Plot}</span></p>\n                <p>Runtime: <time class="dark-color-lighten">${e.Runtime}</time></p>\n                <p>Year: <span class="dark-color-lighten">${e.Year}</span></p>\n                <p>Ranking: <span class="dark-color-lighten">${e.imdbRating}</span></p>\n            </section>`,fragment.appendChild(t),moviesSection.appendChild(fragment)};profile.addEventListener("click",e=>{"login-button"===e.target.id&&insertTemplateInto("login-form-template","append-forms",!0),"register-button"===e.target.id&&insertTemplateInto("sing-in-template","append-forms",!0),"favorites-button"===e.target.id&&favorites.classList.toggle("favorites__active"),"logout-button"===e.target.id&&(seSt.removeItem("currentUser"),favorites.classList.contains("favorites__active")&&favorites.classList.remove("favorites__active"),removeComponentsFrom("append-forms"),removeComponentsFrom("movies"),replaceClass("append-forms","append-forms--search","append-forms--profile"),insertTemplateInto("login-and-register-template","profile",!0))}),appendForms.addEventListener("submit",e=>{if(e.preventDefault(),"login-form"===e.target.id){const e=document.getElementById("login-name"),t=document.getElementById("login-pass"),a=e.value.trim(),r=t.value.trim();if(""!==a&&""!==r){getUserLogin({id:`${a}${r}`}.id)}else""==a&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==r&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900))}if("sing-in-form"===e.target.id){const e=document.getElementById("sing-in-name"),t=document.getElementById("sing-in-pass"),a=document.getElementById("repeat-pass"),r=e.value.trim(),s=t.value.trim(),n=a.value.trim();if(""!==r&&""!==s&&""!==n)if(s===n){setNewUser({id:`${r}${s}`,favoriteMovies:[]})}else alertEmptyField(a,"alert",1900);else""==e.value.trim()&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==t.value.trim()&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900)),""==a.value.trim()&&(alertEmptyField(a,"alert",1900),changePlaceholderValue(a,"Repite la contraseña","Repite la contraseña",1900))}if("search-form"===e.target.id){const e=document.getElementById("search-form"),t=document.getElementById("search").value.trim().toLowerCase();""!==t&&(axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&s="+t}).then(e=>{"True"===e.data.Response?(removeComponentsFrom("movies"),insertMovies(e.data.Search)):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")}),e.reset())}}),appendForms.addEventListener("keyup",e=>{if("sing-in-pass"===e.target.id||"repeat-pass"===e.target.id){const e=document.getElementById("sing-in-pass"),t=document.getElementById("repeat-pass"),a=e.value.trim(),r=t.value.trim();""!==a&&""!==t&&(r===a?t.classList.add("equal-to"):t.classList.remove("equal-to"))}}),appendForms.addEventListener("click",e=>{"remove-component"===e.target.dataset.removecomponent&&removeComponentsFrom("append-forms")}),closeFavs.addEventListener("click",()=>{favorites.classList.remove("favorites__active")}),moviesSection.addEventListener("click",e=>{var t;"show-info"===e.target.dataset.id&&(t=e.target.dataset.imdbid,axios({method:"GET",url:`https://www.omdbapi.com/?apikey=8651a58e&i=${t}&plot=full`}).then(e=>{insertInfo(e.data)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})),"remove-component"===e.target.dataset.removecomponent&&moviesSection.removeChild(e.target.parentElement.parentElement),"add-favorite"===e.target.dataset.addfavorite&&console.log(e.target.parentElement.dataset.favoriteid)}),document.addEventListener("DOMContentLoaded",()=>{null===seSt.getItem("currentUser")?(insertTemplateInto("welcome-template","append-forms",!0),insertTemplateInto("login-and-register-template","profile")):getUserLogin(JSON.parse(seSt.getItem("currentUser")))});