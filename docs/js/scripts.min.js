"use strict";const profile=document.getElementById("profile"),appendForms=document.getElementById("append-forms"),moviesSection=document.getElementById("movies"),favorites=document.getElementById("favorites"),favsMovies=document.getElementById("favorites__movies"),alerts=document.getElementById("alerts"),time=2500,fragment=document.createDocumentFragment(),insertIfExistsUser=()=>{insertTemplateInto("logged-in-template","profile",!0),insertTemplateInto("search-form-template","append-forms",!0),replaceClass("append-forms","append-forms--profile","append-forms--search")},replaceClass=(e,t,a)=>{const o=document.getElementById(e);o&&o.classList.contains(t)?o.classList.replace(t,a):console.error(`La función "replaceClass()" dice: El elemento "${o}" no existe o no tiene la clase "${t}".`)},createElemForAlert=(e,t,a,o)=>{const r=document.createElement(e.toUpperCase()),n=document.getElementById(o);a.forEach(e=>{r.classList.add(e)}),r.textContent=t,n.appendChild(r),setTimeout(()=>{n.textContent=""},2500)},insertTemplateInto=(e,t,a=!1)=>{const o=document.getElementById(e),r=document.getElementById(t);if(o&&r){const e=document.importNode(o.content,!0);a&&(r.textContent=""),r.appendChild(e)}else console.error(`La función insertTemplate() dice: El elemento ${e} o ${t} no existen.`)},removeComponentsFrom=e=>{const t=document.getElementById(e);t&&(t.textContent="")},alertEmptyField=(e,t,a)=>{e?(e.classList.add(t),setTimeout(()=>{e.classList.remove(t)},a)):console.error(`La función "alertEmptyField()" dice: El elemento "${e}" no existe.`)},changePlaceholderValue=(e,t,a,o)=>{e?(e.placeholder=t,setTimeout(()=>{e.placeholder=a},o)):console.error(`La función "changePlaceholderValue()" dice: El elemento "${e}" no existe.`)},seSt=sessionStorage,setCurrentUser=e=>{seSt.setItem("currentUser",JSON.stringify(e)),insertTemplateInto("logged-in-template","profile",!0),insertTemplateInto("search-form-template","append-forms",!0),replaceClass("append-forms","append-forms--profile","append-forms--search")},getCurrentUser=()=>JSON.parse(seSt.getItem("currentUser")),currentUserLoggedIn=()=>null!==seSt.getItem("currentUser"),singOff=()=>{seSt.removeItem("currentUser"),favorites.classList.contains("favorites__active")&&favorites.classList.remove("favorites__active")},loSt=localStorage,ifUserExists=e=>{if(null!==loSt.getItem("movie-finder-users")){const t=JSON.parse(loSt.getItem("movie-finder-users"));let a=0;return t.forEach(t=>{t.id===e&&(a=1)}),1===a}return!1},setNewUser=e=>{if(null===loSt.getItem("movie-finder-users")){const t=[];t.push(e),setCurrentUser(e.id),loSt.setItem("movie-finder-users",JSON.stringify(t))}else{const t=JSON.parse(loSt.getItem("movie-finder-users"));ifUserExists(e.id)?createElemForAlert("p",`El usuario ${e.id} ya existe.`,["alerts__alert","alert"],"alerts"):(t.push(e),setCurrentUser(e.id)),loSt.setItem("movie-finder-users",JSON.stringify(t))}},getUserLogin=e=>{ifUserExists(e)?setCurrentUser(e):createElemForAlert("p",`El usuario ${e} no existe.`,["alerts__alert","alert"],"alerts")},updateFavoriteMovies=e=>{const t=getCurrentUser(),a=JSON.parse(loSt.getItem("movie-finder-users")),o=a.find(e=>e.id===t).favoriteMovies;if(o.length>0){if(o.find(t=>t.idMovie===e.idMovie))for(let t=0;t<o.length;t++){o[t].idMovie===e.idMovie&&o.splice(t,1)}else o.push(e)}else o.push(e);loSt.setItem("movie-finder-users",JSON.stringify(a)),appendFavoritesMovies()},apikey="8651a58e",searchMovies=e=>{axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?(removeComponentsFrom("movies"),insertMovies(e.data.Search)):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},searchTitle=e=>{axios({method:"GET",url:`https://www.omdbapi.com/?apikey=8651a58e&i=${e}&plot=full`}).then(e=>{insertInfo(e.data)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},getDataFavoriteMovie=e=>{axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&i="+e}).then(e=>{updateFavoriteMovies({idMovie:e.data.imdbID,title:e.data.Title,poster:e.data.Poster})}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},insertMovie=e=>{const t=document.createElement("ARTICLE");t.classList.add("movie"),t.dataset.id=e.imdbID,"N/A"===e.Poster&&(e.Poster="./assets/images/no_image_available/noimageavailable.png"),t.innerHTML=`<button class="button movie__favorite" data-favoriteid="${e.imdbID}">\n            <img src="./assets/favorites/bookmark.svg" class="movie__favorite--svg" data-addfavorite="add-favorite">\n        </button>\n        <picture class="movie__poster">\n            <img src="${e.Poster}" class="poster">\n        </picture>\n        <div class="movie__info">\n            <h2 class="movie__title">${e.Title}</h2>\n            <button class="movie__button button button--cta" data-id="show-info" data-imdbid="${e.imdbID}">Información</button>\n        </div>`,fragment.appendChild(t)},insertMovies=e=>{e.forEach(e=>{insertMovie(e)}),moviesSection.appendChild(fragment)},insertInfo=e=>{const t=document.createElement("ARTICLE");t.classList.add("movie-info"),t.innerHTML=`\n        <div class="remove-component">\n            <button data-removecomponent="remove-component"\n            class="remove-component__trigger button button--secondary">X</button>\n        </div>\n        <div class="movie-info__content">\n            <picture class="movies-info__poster">\n                <img src="${e.Poster}">\n            </picture>\n            <section class="movies-info__details">\n                <h1 class="movies-info__title">${e.Title}</h1>\n                <p>Actors: <span>${e.Actors}</span></p>\n                <p>Writes: <span>${e.Writer}</span></p>\n                <p>Production: <span>${e.Production}</span></p>\n                <p>Director: <span>${e.Director}</span></p>\n                <p>Genre: <span>${e.Genre}</span></p>\n                <p>Language: <span>${e.Language}</span></p>\n                <p>Plot: <span>${e.Plot}</span></p>\n                <p>Runtime: <time>${e.Runtime}</time></p>\n                <p>Year: <span>${e.Year}</span></p>\n                <p>Ranking: <span>${e.imdbRating}</span></p>\n            </section>\n        </div>\n        `,fragment.appendChild(t),moviesSection.appendChild(fragment)},inserFavorite=e=>{const t=document.createElement("ARTICLE");t.classList.add("favorite"),"N/A"===e.poster&&(e.poster="./assets/images/no_image_available/noimageavailable.png"),t.innerHTML=`<div class="remove-component">\n            <button data-imdbid="${e.idMovie}" data-removecomponent="remove-component" class="remove-component__trigger button button--secondary">X</button>\n        </div>\n        <div class="favorite__info movie__info">\n            <p>${e.title}</p>\n            <button class="movie__button button button--cta" data-id="show-info" data-imdbid="${e.idMovie}">Información</button>\n        </div>\n        <picture>\n            <img src="${e.poster}">\n        </picture>`,fragment.appendChild(t)},appendFavoritesMovies=()=>{const e=getCurrentUser(),t=JSON.parse(loSt.getItem("movie-finder-users")).find(t=>t.id===e).favoriteMovies;favsMovies.textContent="",t.forEach(e=>{inserFavorite(e)}),favsMovies.appendChild(fragment)};profile.addEventListener("click",e=>{"login-button"===e.target.id&&insertTemplateInto("login-form-template","append-forms",!0),"register-button"===e.target.id&&insertTemplateInto("sing-in-template","append-forms",!0),"favorites-button"===e.target.id&&favorites.classList.toggle("favorites__active"),"logout-button"===e.target.id&&(seSt.removeItem("currentUser"),favorites.classList.contains("favorites__active")&&favorites.classList.remove("favorites__active"),removeComponentsFrom("append-forms"),removeComponentsFrom("movies"),replaceClass("append-forms","append-forms--search","append-forms--profile"),insertTemplateInto("login-and-register-template","profile",!0),appendFavoritesMovies())}),appendForms.addEventListener("submit",e=>{if(e.preventDefault(),"login-form"===e.target.id){const e=document.getElementById("login-name"),t=document.getElementById("login-pass"),a=e.value.trim(),o=t.value.trim();if(""!==a&&""!==o){getUserLogin({id:`${a}${o}`}.id),appendFavoritesMovies()}else""==a&&(alertEmptyField(e,"alert",2500),changePlaceholderValue(e,"Ingresa un usuario","Usuario",2500)),""==o&&(alertEmptyField(t,"alert",2500),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",2500))}if("sing-in-form"===e.target.id){const e=document.getElementById("sing-in-name"),t=document.getElementById("sing-in-pass"),a=document.getElementById("repeat-pass"),o=e.value.trim(),r=t.value.trim(),n=a.value.trim();if(""!==o&&""!==r&&""!==n)if(r===n){setNewUser({id:`${o}${r}`,favoriteMovies:[]})}else alertEmptyField(a,"alert",2500);else""==e.value.trim()&&(alertEmptyField(e,"alert",2500),changePlaceholderValue(e,"Ingresa un usuario","Usuario",2500)),""==t.value.trim()&&(alertEmptyField(t,"alert",2500),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",2500)),""==a.value.trim()&&(alertEmptyField(a,"alert",2500),changePlaceholderValue(a,"Repite la contraseña","Repite la contraseña",2500))}if("search-form"===e.target.id){const e=document.getElementById("search-form"),t=document.getElementById("search").value.trim().toLowerCase();""!==t&&(axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&s="+t}).then(e=>{"True"===e.data.Response?(removeComponentsFrom("movies"),insertMovies(e.data.Search)):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")}),e.reset())}}),appendForms.addEventListener("keyup",e=>{if("sing-in-pass"===e.target.id||"repeat-pass"===e.target.id){const e=document.getElementById("sing-in-pass"),t=document.getElementById("repeat-pass"),a=e.value.trim(),o=t.value.trim();""!==a&&""!==t&&(o===a?t.classList.add("equal-to"):t.classList.remove("equal-to"))}}),appendForms.addEventListener("click",e=>{"remove-component"===e.target.dataset.removecomponent&&removeComponentsFrom("append-forms")}),favorites.addEventListener("click",e=>{"remove-component"===e.target.dataset.removecomponent&&(favsMovies.removeChild(e.target.parentElement.parentElement),updateFavoriteMovies({idMovie:e.target.dataset.imdbid})),"close-favorites"===e.target.id&&favorites.classList.remove("favorites__active"),"show-info"===e.target.dataset.id&&searchTitle(e.target.dataset.imdbid)}),moviesSection.addEventListener("click",e=>{var t;"show-info"===e.target.dataset.id&&searchTitle(e.target.dataset.imdbid),"remove-component"===e.target.dataset.removecomponent&&moviesSection.removeChild(e.target.parentElement.parentElement),"add-favorite"===e.target.dataset.addfavorite&&(t=e.target.parentElement.dataset.favoriteid,axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&i="+t}).then(e=>{updateFavoriteMovies({idMovie:e.data.imdbID,title:e.data.Title,poster:e.data.Poster})}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})),console.log(e.target)}),document.addEventListener("DOMContentLoaded",()=>{null===seSt.getItem("currentUser")?(insertTemplateInto("welcome-template","append-forms",!0),insertTemplateInto("login-and-register-template","profile")):(getUserLogin(getCurrentUser()),appendFavoritesMovies())});