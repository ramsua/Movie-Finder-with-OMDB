"use strict";const account=document.getElementById("account"),appendForms=document.getElementById("append-forms"),moviesSection=document.getElementById("movies"),favorites=document.getElementById("favorites"),closeFavs=document.getElementById("close-favorites"),favsMovies=document.getElementById("favorites__movies"),alerts=document.getElementById("alerts"),time=1900,fragment=document.createDocumentFragment(),insertTemplate=(e,t,a=!1)=>{const s=document.getElementById(e),r=document.getElementById(t);if(s&&r){const e=document.importNode(s.content,!0);a&&(r.textContent=""),r.appendChild(e)}else console.error(`La función insertTemplate() dice: El elemento ${e} o ${t} no existen.`)},removeTemplate=e=>{const t=document.getElementById(e);t&&(t.textContent="")},alertEmptyField=(e,t,a)=>{e?(e.classList.add(t),setTimeout(()=>{e.classList.remove(t)},a)):console.error(`La función "alertEmptyField()" dice: El elemento "${e}" no existe.`)},changePlaceholderValue=(e,t,a,s)=>{e?(e.placeholder=t,setTimeout(()=>{e.placeholder=a},s)):console.error(`La función "changePlaceholderValue()" dice: El elemento "${e}" no existe.`)},replaceClass=(e,t,a)=>{const s=document.getElementById(e);s&&s.classList.contains(t)?s.classList.replace(t,a):console.error(`La función "replaceClass()" dice: El elemento "${s}" no existe o no tiene la clase "${t}".`)},insertIfExistsUser=()=>{insertTemplate("logged-in-template","account",!0),insertTemplate("search-form-template","append-forms",!0),replaceClass("append-forms","forms__modal--account","forms__modal--search")},createElemForAlert=(e,t,a,s)=>{const r=document.createElement(e),n=document.getElementById(s);a.forEach(e=>{r.classList.add(e)}),r.textContent=t,n.appendChild(r),setTimeout(()=>{n.textContent=""},1750)},loSt=localStorage,ifUserExists=e=>{if(null!==loSt.getItem("movie-finder-users")){const t=JSON.parse(loSt.getItem("movie-finder-users"));let a=0;return t.forEach(t=>{t.id===e&&(a=1)}),1===a}return!1},setNewUser=e=>{if(null===loSt.getItem("movie-finder-users")){const t=[];t.push(e),setCurrentUser(e.id),loSt.setItem("movie-finder-users",JSON.stringify(t))}else{const t=JSON.parse(loSt.getItem("movie-finder-users"));ifUserExists(e.id)?createElemForAlert("p",`El usuario ${e.id} ya existe.`,["alerts__alert","alert"],"alerts"):(t.push(e),setCurrentUser(e.id)),loSt.setItem("movie-finder-users",JSON.stringify(t))}},getUserLogin=e=>{ifUserExists(e)?setCurrentUser(e):createElemForAlert("p",`El usuario ${e} no existe.`,["alerts__alert","alert"],"alerts")},seSt=sessionStorage,setCurrentUser=e=>{seSt.setItem("currentUser",JSON.stringify(e)),insertTemplate("logged-in-template","account",!0),insertTemplate("search-form-template","append-forms",!0),replaceClass("append-forms","forms__modal--account","forms__modal--search")},getCurrentUser=()=>JSON.parse(seSt.getItem("currentUser")),currentUserLoggedIn=()=>null!==seSt.getItem("currentUser"),singOff=()=>{seSt.removeItem("currentUser"),favorites.classList.contains("favorites__right")&&favorites.classList.remove("favorites__right")},apikey="8651a58e",searchMovies=e=>{axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?(removeTemplate("movies"),insertMovies(e.data.Search)):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},searchTitle=e=>{axios({method:"GET",url:`https://www.omdbapi.com/?apikey=8651a58e&i=${e}&plot=full`}).then(e=>{insertInfo(e.data)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},insertMovie=e=>{const t=document.createElement("DIV");t.classList.add("movie"),t.innerHTML=`<button class="button movie__favorite" data-favoriteid="${e.imdbID}">\n            <img src="./assets/favorites/bookmark.svg" class="movie__favorite--svg" data-addfavorite="add-favorite">\n        </button>\n        <div class="movie__poster">\n            <img src="${e.Poster}" class="poster">\n        </div>\n        <div class="movie__info">\n            <h2 class="movie__title">${e.Title}</h2>\n            <button class="movie__button button button--call-to-action" data-id="show-info" data-imdbid="${e.imdbID}">Información</button>\n        </div>`,fragment.appendChild(t)},insertMovies=e=>{e.forEach(e=>{insertMovie(e)}),moviesSection.appendChild(fragment)},insertInfo=e=>{const t=document.createElement("DIV");t.classList.add("movies__info"),t.innerHTML=`<div class="close">\n                <button data-close="close" class="button button--close">X</button>\n            </div>\n            <div class="movies__info--img">\n                <img src="${e.Poster}">\n            </div>\n            <div class="movies__info--details">\n                <h1 class="movies__info--title">${e.Title}</h1>\n                <p>Actors: ${e.Actors}</p>\n                <p>Writes: ${e.Writer}</p>\n                <p>Production: ${e.Production}</p>\n                <p>Director: ${e.Director}</p>\n                <p>Genre: ${e.Genre}</p>\n                <p>Language: ${e.Language}</p>\n                <p>Plot: ${e.Plot}</p>\n                <p>Runtime: ${e.Runtime}</p>\n                <p>Year: ${e.Year}</p>\n                <p>Ranking: ${e.imdbRating}</p>\n            </div>`,fragment.appendChild(t),moviesSection.appendChild(fragment)};document.addEventListener("DOMContentLoaded",()=>{null===seSt.getItem("currentUser")?(insertTemplate("messages-template","append-forms",!0),insertTemplate("login-and-register-template","account")):getUserLogin(JSON.parse(seSt.getItem("currentUser")))}),account.addEventListener("click",e=>{"login-button"===e.target.id&&insertTemplate("login-form-template","append-forms",!0),"register-button"===e.target.id&&insertTemplate("sing-in-template","append-forms",!0),"favorites-button"===e.target.id&&favorites.classList.toggle("favorites__right"),"logout-button"===e.target.id&&(seSt.removeItem("currentUser"),favorites.classList.contains("favorites__right")&&favorites.classList.remove("favorites__right"),removeTemplate("append-forms"),removeTemplate("movies"),replaceClass("append-forms","forms__modal--search","forms__modal--account"),insertTemplate("login-and-register-template","account",!0))}),appendForms.addEventListener("submit",e=>{if(e.preventDefault(),"login-form"===e.target.id){const e=document.getElementById("login-name"),t=document.getElementById("login-pass"),a=e.value.trim(),s=t.value.trim();if(""!==a&&""!==s){getUserLogin({id:`${a}${s}`}.id)}else""==a&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==s&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900))}if("sing-in-form"===e.target.id){const e=document.getElementById("sing-in-name"),t=document.getElementById("sing-in-pass"),a=document.getElementById("repeat-pass"),s=e.value.trim(),r=t.value.trim(),n=a.value.trim();if(""!==s&&""!==r&&""!==n)if(r===n){setNewUser({id:`${s}${r}`,favoriteMovies:[]})}else alertEmptyField(a,"alert",1900);else""==e.value.trim()&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==t.value.trim()&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900)),""==a.value.trim()&&(alertEmptyField(a,"alert",1900),changePlaceholderValue(a,"Repite la contraseña","Repite la contraseña",1900))}if("search-form"===e.target.id){const e=document.getElementById("search-form"),t=document.getElementById("search").value.trim().toLowerCase();""!==t&&(axios({method:"GET",url:"https://www.omdbapi.com/?apikey=8651a58e&s="+t}).then(e=>{"True"===e.data.Response?(removeTemplate("movies"),insertMovies(e.data.Search)):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")}),e.reset())}}),appendForms.addEventListener("keyup",e=>{if("sing-in-pass"===e.target.id||"repeat-pass"===e.target.id){const e=document.getElementById("sing-in-pass"),t=document.getElementById("repeat-pass"),a=e.value.trim(),s=t.value.trim();""!==a&&""!==t&&(s===a?t.classList.add("equal-to"):t.classList.remove("equal-to"))}}),appendForms.addEventListener("click",e=>{"close"===e.target.dataset.close&&(appendForms.textContent="")}),closeFavs.addEventListener("click",()=>{favorites.classList.remove("favorites__right")}),moviesSection.addEventListener("click",e=>{var t;"show-info"===e.target.dataset.id&&(t=e.target.dataset.imdbid,axios({method:"GET",url:`https://www.omdbapi.com/?apikey=8651a58e&i=${t}&plot=full`}).then(e=>{insertInfo(e.data)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})),"close"===e.target.dataset.close&&moviesSection.removeChild(e.target.parentElement.parentElement),"add-favorite"===e.target.dataset.addfavorite&&console.log(e.target.parentElement.dataset.favoriteid)});