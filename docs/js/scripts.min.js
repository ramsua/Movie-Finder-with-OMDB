"use strict";const account=document.getElementById("account"),appendForms=document.getElementById("append-forms"),moviesSection=document.getElementById("movies"),favorites=document.getElementById("favorites"),closeFavs=document.getElementById("close-favorites"),favsMovies=document.getElementById("favorites__movies"),alerts=document.getElementById("alerts"),time=1900,insertTemplate=(e,t,a=!1)=>{const r=document.getElementById(e),s=document.getElementById(t);if(r&&s){const e=document.importNode(r.content,!0);a&&(s.textContent=""),s.appendChild(e)}else console.error(`La función insertTemplate() dice: El elemento ${e} o ${t} no existen.`)},removeTemplate=e=>{const t=document.getElementById(e);t&&(t.textContent="")},alertEmptyField=(e,t,a)=>{e?(e.classList.add(t),setTimeout(()=>{e.classList.remove(t)},a)):console.error(`La función "alertEmptyField()" dice: El elemento "${e}" no existe.`)},changePlaceholderValue=(e,t,a,r)=>{e?(e.placeholder=t,setTimeout(()=>{e.placeholder=a},r)):console.error(`La función "changePlaceholderValue()" dice: El elemento "${e}" no existe.`)},replaceClass=(e,t,a)=>{const r=document.getElementById(e);r&&r.classList.contains(t)?r.classList.replace(t,a):console.error(`La función "replaceClass()" dice: El elemento "${r}" no existe o no tiene la clase "${t}".`)},insertIfExistsUser=()=>{insertTemplate("logged-in-template","account",!0),insertTemplate("search-form-template","append-forms",!0),replaceClass("append-forms","forms__modal--account","forms__modal--search")},createElemForAlert=(e,t,a,r)=>{const s=document.createElement(e),o=document.getElementById(r);a.forEach(e=>{s.classList.add(e)}),s.textContent=t,o.appendChild(s),setTimeout(()=>{o.textContent=""},1750)},loSt=localStorage,ifUserExists=e=>{if(null!==loSt.getItem("movie-finder-users")){const t=JSON.parse(loSt.getItem("movie-finder-users"));let a=0;return t.forEach(t=>{t.id===e&&(a=1)}),1===a}return!1},setNewUser=e=>{if(null===loSt.getItem("movie-finder-users")){const t=[];t.push(e),setCurrentUser(e.id),loSt.setItem("movie-finder-users",JSON.stringify(t))}else{const t=JSON.parse(loSt.getItem("movie-finder-users"));ifUserExists(e.id)?createElemForAlert("p",`El usuario ${e.id} ya existe.`,["alerts__alert","alert"],"alerts"):(t.push(e),setCurrentUser(e.id)),loSt.setItem("movie-finder-users",JSON.stringify(t))}},getUserLogin=e=>{ifUserExists(e)?setCurrentUser(e):createElemForAlert("p",`El usuario ${e} no existe.`,["alerts__alert","alert"],"alerts")},seSt=sessionStorage,setCurrentUser=e=>{seSt.setItem("currentUser",JSON.stringify(e)),insertTemplate("logged-in-template","account",!0),insertTemplate("search-form-template","append-forms",!0),replaceClass("append-forms","forms__modal--account","forms__modal--search")},getCurrentUser=()=>JSON.parse(seSt.getItem("currentUser")),currentUserLoggedIn=()=>null!==seSt.getItem("currentUser"),singOff=()=>{seSt.removeItem("currentUser"),favorites.classList.contains("favorites__right")&&favorites.classList.remove("favorites__right")},apikey="8651a58e",searchMovies=e=>{axios({method:"GET",url:"http://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?appendMovies(e.data.Search):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},searchTitle=e=>{axios({method:"GET",url:`http://www.omdbapi.com/?apikey=8651a58e&t=${e}&plot=full`}).then(e=>{console.log(e)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},createCustomElement=(e,t,a)=>{let r=document.createElement(e.toUpperCase());return void 0!==a&&a.forEach(e=>{e.nodeType?1!==e.nodeType&&11!==e.nodeType||r.appendChild(e):r.innerHTML+=e}),addAttributes(r,t),r},addAttributes=(e,t)=>{for(let a in t)t.hasOwnProperty(a)&&e.setAttribute(a,t[a])},appendMovies=e=>{createElement("DIV");e.forEach(e=>{console.log(e)})};document.addEventListener("DOMContentLoaded",()=>{null===seSt.getItem("currentUser")?(insertTemplate("messages-template","append-forms",!0),insertTemplate("login-and-register-template","account")):getUserLogin(JSON.parse(seSt.getItem("currentUser")))}),account.addEventListener("click",e=>{"login-button"===e.target.id&&insertTemplate("login-form-template","append-forms",!0),"register-button"===e.target.id&&insertTemplate("sing-in-template","append-forms",!0),"favorites-button"===e.target.id&&favorites.classList.toggle("favorites__right"),"logout-button"===e.target.id&&(seSt.removeItem("currentUser"),favorites.classList.contains("favorites__right")&&favorites.classList.remove("favorites__right"),removeTemplate("append-forms"),replaceClass("append-forms","forms__modal--search","forms__modal--account"),insertTemplate("login-and-register-template","account",!0))}),appendForms.addEventListener("submit",e=>{if(e.preventDefault(),"login-form"===e.target.id){const e=document.getElementById("login-name"),t=document.getElementById("login-pass"),a=e.value.trim(),r=t.value.trim();if(""!==a&&""!==r){getUserLogin({id:`${a}${r}`}.id)}else""==a&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==r&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900))}if("sing-in-form"===e.target.id){const e=document.getElementById("sing-in-name"),t=document.getElementById("sing-in-pass"),a=document.getElementById("repeat-pass"),r=e.value.trim(),s=t.value.trim(),o=a.value.trim();if(""!==r&&""!==s&&""!==o)if(s===o){setNewUser({id:`${r}${s}`,favoriteMovies:[]})}else alertEmptyField(a,"alert",1900);else""==e.value.trim()&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==t.value.trim()&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900)),""==a.value.trim()&&(alertEmptyField(a,"alert",1900),changePlaceholderValue(a,"Repite la contraseña","Repite la contraseña",1900))}if("search-form"===e.target.id){const e=document.getElementById("search").value.trim().toLowerCase();""!==e&&axios({method:"GET",url:"http://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?appendMovies(e.data.Search):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})}}),appendForms.addEventListener("keyup",e=>{if("sing-in-pass"===e.target.id||"repeat-pass"===e.target.id){const e=document.getElementById("sing-in-pass"),t=document.getElementById("repeat-pass"),a=e.value.trim(),r=t.value.trim();""!==a&&""!==t&&(r===a?t.classList.add("equal-to"):t.classList.remove("equal-to"))}}),appendForms.addEventListener("click",e=>{"close"===e.target.dataset.close&&(appendForms.textContent="")}),closeFavs.addEventListener("click",()=>{favorites.classList.remove("favorites__right")}),moviesSection.addEventListener("click",e=>{"show-info"===e.target.dataset.id&&console.log("Funciona"),"close"===e.target.dataset.close&&moviesSection.removeChild(e.target.parentElement.parentElement),"favorite"!==e.target.dataset.favorite&&"add-favorite"!==e.target.dataset.addfavorite||console.log("Fav")});