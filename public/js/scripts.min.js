"use strict";const account=document.getElementById("account"),appendForms=document.getElementById("append-forms"),moviesSection=document.getElementById("movies"),favorites=document.getElementById("favorites"),closeFavs=document.getElementById("close-favorites"),favsMovies=document.getElementById("favorites__movies"),alerts=document.getElementById("alerts"),time=1900,insertTemplate=(e,t,r=!1)=>{const a=document.getElementById(e),s=document.getElementById(t);if(a&&s){const e=document.importNode(a.content,!0);r&&(s.textContent=""),s.appendChild(e)}else console.error(`La función insertTemplate() dice: El elemento ${e} o ${t} no existen.`)},removeTemplate=e=>{const t=document.getElementById(e);t&&(t.textContent="")},alertEmptyField=(e,t,r)=>{e?(e.classList.add(t),setTimeout(()=>{e.classList.remove(t)},r)):console.error(`La función "alertEmptyField()" dice: El elemento "${e}" no existe.`)},changePlaceholderValue=(e,t,r,a)=>{e?(e.placeholder=t,setTimeout(()=>{e.placeholder=r},a)):console.error(`La función "changePlaceholderValue()" dice: El elemento "${e}" no existe.`)},replaceClass=(e,t,r)=>{const a=document.getElementById(e);a&&a.classList.contains(t)?a.classList.replace(t,r):console.error(`La función "replaceClass()" dice: El elemento "${a}" no existe o no tiene la clase "${t}".`)},insertIfExistsUser=()=>{insertTemplate("logged-in-template","account",!0),insertTemplate("search-form-template","append-forms",!0),replaceClass("append-forms","forms__modal--account","forms__modal--search")},createElemForAlert=(e,t,r,a)=>{const s=document.createElement(e),o=document.getElementById(a);r.forEach(e=>{s.classList.add(e)}),s.textContent=t,o.appendChild(s),setTimeout(()=>{o.textContent=""},1750)},loSt=localStorage,ifUserExists=e=>{if(null!==loSt.getItem("movie-finder-users")){const t=JSON.parse(loSt.getItem("movie-finder-users"));let r=0;return t.forEach(t=>{t.id===e&&(r=1)}),1===r}return!1},setNewUser=e=>{if(null===loSt.getItem("movie-finder-users")){const t=[];t.push(e),setCurrentUser(e.id),loSt.setItem("movie-finder-users",JSON.stringify(t))}else{const t=JSON.parse(loSt.getItem("movie-finder-users"));ifUserExists(e.id)?createElemForAlert("p",`El usuario ${e.id} ya existe.`,["alerts__alert","alert"],"alerts"):(t.push(e),setCurrentUser(e.id)),loSt.setItem("movie-finder-users",JSON.stringify(t))}},getUserLogin=e=>{ifUserExists(e)?setCurrentUser(e):createElemForAlert("p",`El usuario ${e} no existe.`,["alerts__alert","alert"],"alerts")},seSt=sessionStorage,setCurrentUser=e=>{seSt.setItem("currentUser",JSON.stringify(e)),insertTemplate("logged-in-template","account",!0),insertTemplate("search-form-template","append-forms",!0),replaceClass("append-forms","forms__modal--account","forms__modal--search")},getCurrentUser=()=>JSON.parse(seSt.getItem("currentUser")),currentUserLoggedIn=()=>null!==seSt.getItem("currentUser"),singOff=()=>{seSt.removeItem("currentUser"),favorites.classList.contains("favorites__right")&&favorites.classList.remove("favorites__right")},apikey="8651a58e",searchMovies=e=>{axios({method:"GET",url:"http://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?appendMovies(e.data.Search):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},searchTitle=e=>{axios({method:"GET",url:`http://www.omdbapi.com/?apikey=8651a58e&t=${e}&plot=full`}).then(e=>{console.log(e)}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})},appendMovies=e=>{e.forEach(e=>{console.log(e)})};document.addEventListener("DOMContentLoaded",()=>{null===seSt.getItem("currentUser")?(insertTemplate("messages-template","append-forms",!0),insertTemplate("login-and-register-template","account")):getUserLogin(JSON.parse(seSt.getItem("currentUser")))}),account.addEventListener("click",e=>{"login-button"===e.target.id&&insertTemplate("login-form-template","append-forms",!0),"register-button"===e.target.id&&insertTemplate("sing-in-template","append-forms",!0),"favorites-button"===e.target.id&&favorites.classList.toggle("favorites__right"),"logout-button"===e.target.id&&(seSt.removeItem("currentUser"),favorites.classList.contains("favorites__right")&&favorites.classList.remove("favorites__right"),removeTemplate("append-forms"),replaceClass("append-forms","forms__modal--search","forms__modal--account"),insertTemplate("login-and-register-template","account",!0))}),appendForms.addEventListener("submit",e=>{if(e.preventDefault(),"login-form"===e.target.id){const e=document.getElementById("login-name"),t=document.getElementById("login-pass"),r=e.value.trim(),a=t.value.trim();if(""!==r&&""!==a){getUserLogin({id:`${r}${a}`}.id)}else""==r&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==a&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900))}if("sing-in-form"===e.target.id){const e=document.getElementById("sing-in-name"),t=document.getElementById("sing-in-pass"),r=document.getElementById("repeat-pass"),a=e.value.trim(),s=t.value.trim(),o=r.value.trim();if(""!==a&&""!==s&&""!==o)if(s===o){setNewUser({id:`${a}${s}`,favoriteMovies:[]})}else alertEmptyField(r,"alert",1900);else""==e.value.trim()&&(alertEmptyField(e,"alert",1900),changePlaceholderValue(e,"Ingresa un usuario","Usuario",1900)),""==t.value.trim()&&(alertEmptyField(t,"alert",1900),changePlaceholderValue(t,"Ingresa una contraseña","Contraseña",1900)),""==r.value.trim()&&(alertEmptyField(r,"alert",1900),changePlaceholderValue(r,"Repite la contraseña","Repite la contraseña",1900))}if("search-form"===e.target.id){const e=document.getElementById("search").value.trim().toLowerCase();""!==e&&axios({method:"GET",url:"http://www.omdbapi.com/?apikey=8651a58e&s="+e}).then(e=>{"True"===e.data.Response?appendMovies(e.data.Search):createElemForAlert("p","Película no encontrada",["alerts__alert","alert"],"alerts")}).catch(e=>{createElemForAlert("p",e+" no se encontró",["alerts__alert","alert"],"alerts")})}}),appendForms.addEventListener("keyup",e=>{if("sing-in-pass"===e.target.id||"repeat-pass"===e.target.id){const e=document.getElementById("sing-in-pass"),t=document.getElementById("repeat-pass"),r=e.value.trim(),a=t.value.trim();""!==r&&""!==t&&(a===r?t.classList.add("equal-to"):t.classList.remove("equal-to"))}}),appendForms.addEventListener("click",e=>{"close"===e.target.dataset.close&&(appendForms.textContent="")}),closeFavs.addEventListener("click",()=>{favorites.classList.remove("favorites__right")}),moviesSection.addEventListener("click",e=>{console.log(e.target)});